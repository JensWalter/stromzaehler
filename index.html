<html>

<body>
    <video autoplay></video>
    <canvas></canvas>
</body>
<script>
    var stream;
    var track;
    async function takepicture() {
        let canvas = document.querySelector('canvas');
        let video = document.querySelector('video');
        await torchOn();
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const context = canvas.getContext('2d');
        context.drawImage(video, 0, 0);
        const data = canvas.toDataURL('image/png');
        await torchOff();
    }
    function onCapabilitiesReady(capabilities) {
        if (capabilities.torch) {
            const track = stream.getVideoTracks()[0];
        } else {
            alert('no torch found');
        }
    }
    async function torchOn() {
        return track.applyConstraints({
            advanced: [{ torch: true }]
        });
    }
    async function torchOff() {
        return track.applyConstraints({
            advanced: [{ torch: false }]
        });
    }
    function run() {
        takepicture()
    }
    setInterval(run, 10000);
    async function init() {
        let constraints = { video: { facingMode: 'environment' }, audio: false };
        try {
            stream = await navigator.mediaDevices.getUserMedia(constraints);
        } catch (err) {
            if (err.name == 'OverconstrainedError') {
                stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
            } else {
                console.log(err);
                alert('Reeeejected!', err);
            }
        }
        var video = document.querySelector('video');
        video.srcObject = stream;
        const track = stream.getVideoTracks()[0];
        video.addEventListener('loadedmetadata', (e) => {
            window.setTimeout(() => (
                onCapabilitiesReady(track.getCapabilities())
            ), 500);
        });
    }
    init();
</script>

</html>